---
title: 心率变异性信号分析笔记
tags: [读书,数学]
---

# 1 心率变异：简史#

1. 1963 年 Hon 研究了劳动和投递(delivery)时的 HRV ，同时还研究了 HRV 和胎儿健康的关系。
2. 1971 年 Hyndman 记录了 10 秒自主的血压（BP）变异，并给出了控制系统模型来描述他们的发现。
3. 1978 年 Wolf 等人发现 RR 间隔变异和在医院心肌梗塞病人的死亡率密切相关。
4. 1981 年 Akselrod 等人验证了自主神经系统中交感和副交感神经的活性贡献了频域的 HR 功率谱。同时证明肾激素-血管收缩激素系统的活性和位于 0.04Hz 的峰值的振幅强相关。
5. 1982 年 Ewing 和 Clarke 发现通过 HRV 功率谱可以发现糖尿病。
6. 1987 年 Lombardi 等人发现诸如心肌梗塞这样的心脏病和 HRV 减低相关
7. 1986 年 Myers 等人发现心脏骤停死亡和 HRV 减低相关
8. 1987 年 Kleiger 等人发现 24 小时的时域统计信息，也就是说平均心率的标准差，可以用作死亡预警信号。

# 2 HRV 分析的方法论#

## 2.2 ECG 记录以及 RR 间隔的产生##

### 2.2.1 RR 间隔时间序列###

RR 间隔实际上是一个 **事件序列** 而不是一个连续信号的等效抽样。

HRV 分析不能测量窦房结 (Sinoatrial node) 的节奏，因为 HRV 不是基于 P-P 间隔的。但是用 RR 间隔反映窦房结的变异非常准确。理论上应该用 P-P 间隔的，但是因为 P 波的幅值小，这使得确定 P 波的波峰位置变得困难，而P波峰位置测量的精度又会影响 P-P 间隔测量。

### 2.2.2 ECG 记录的实际和幅值精度###
ECG 记录的抽样频率和幅值分辨率是 HRV 分析的重要参数。

抽样频率决定了从 QRS 结构中认出 R 峰的时刻分辨率，而这又直接决定了 RR 间隔的测量。200Hz 的采样频率是足够高的。再高的采样频率不会给出更好的结果。对于心脏不好的病人，RR 间隔非常短，这个时候需要加大采样频率，才能捕获正确的 RR 间隔。

ECG 信号的模数转化精度很少是一个限制因子。通常 12bit 的精度就足够了。

### 2.2.3 记录的时间###
记录的持续时间，由 HRV 分析方法，研究的目标，以及稳定问题决定。一般来说，频域 HRV 分析适合短时测量，而时域 HRV 分析适合长时测量。非线性的方法，有些适合长时的分析，有些适合短时的分析。同一个方法，对长时和短时记录做分析，生理的解释不同，所以分析的结论不一致。

### 2.2.5 去趋势###
理论上来说，大的趋势是一个稳定系统的动态行为的本质。

从谱分析的观点来说，移除趋势减小了低频的贡献；这样最后的分析就集中在震荡最快的部分了。

最后一点需要注意的就是去趋势不能增加数据的稳定性。克服不稳定性的唯一的办法就是在研究的过程中，最小化内部和外部的干扰。

### 2.2.6 异常心跳，心律不齐和噪声###

EGC 信号包含了技术误差，或者 QRS 原始组分超出了窦房结，这就引起了误差，因为 HRV 分析基于窦性节奏变异值的。

异常的心跳指的是一个早熟的的心跳，产生的 RR 间隔非常短，后面跟一个补偿延迟，也就是一个延长的 RR 间隔。这样的短-长 RR 间隔对，可以通过拉长第一个 RR 间隔和缩短第二个 RR 间隔，使他们变成相等的间隔。异常心跳和大多数的心律不齐会减少心博量(stroke volume)和
心输出(cardiac ouput)，因此会导致短暂的血压降低。这些行为是自动调节完成的，所以真实的生理反映可以持续10-30心跳，因此移除异常心跳两段的两个 RR 间隔不会移除这种真实的心律不齐产生的 HRV 。

## 2.3 时域分析##
HRV 时域分析最常见的指标是 RR 间隔标准差(SDNN)。可以计算5分钟的 SDNN ，也可以计算24小时的 SDNN ，但是比较这两者没有意义，因为 HRV 不是稳定的信号。稳定信号指的是信号的平均值和变异性，与数据的个数不相关。

长程的记录, 低频(LF)变异,贡献了 HRV 能量和 SDNN 的主要部分。因为在心率较高水平的时候， HRV 会减低，所以可以通过除以 RR 间隔的平均值来标准化(normaliz) SDNN，来抵消这个效果。

RR 间隔差值的均方根(RMSSD), RR 间隔差值大于50ms(NN50)的个数,以及NN50的个数和所有的 RR 间隔个数的百分比(pNN50)， 这些反映的都是心率的高频变异性，而且和长效趋势是独立的。因此这几个指标的短效和长效指标应该一致。

时域分析比较简单，也没有耗时的算法，但是缺点是不能区分自主神经系统中的交感和副交感神经的效果。

## 2.4 频域分析##

时域 HRV 测量的是 HRV 整体(overall) 特性。
关于 HRV 动态和频率的更多的信息，需要能量谱密度(Power spectral density, PSD)分析。计算 PSD 的两种常用的方法是:  **傅立叶变换(FT)** 和 **自回归(AR)** 模型。

### 2.4.1 傅立叶变化###

傅立叶变化把时域信息转变为频率信息 ，其逆变化把频域信息转化为时域信息。频域信息和时域信息是同一个信息的两种不同的表示。

对于等时抽样的时间序列 x(t<sub>k</sub>),这里 $t_{k}=k\Delta$ ，是抽样的时刻点,  &Delta; 是抽样间隔。因此离散傅立叶变化就是:


$$
X(f_{n}) = \Delta \sum_{k=0}^{N-1} x(t_k)e^{-i2\pi f_{n} t_{k}}=\Delta \sum_{k=0}^{N-1} x(t_{k})e^{-i2\pi k n/N},其中 f_n = \frac {n}{N\Delta}
$$

功率密度谱(PSD)定义为：

$$
PSD(f_n)=| X(f_n)|^{2},对应的就是频率 f_{n} 幅度的平方。
$$


### 2.4.2 自回归(AR)模型###

AR 模型的基本的思想是：一个时间序列的未来值线性的依赖于以前的值。也就是：


$$
x_k=\sum_{j=1} ^{p} a_{j}x_{k-1} +u_k
$$


a<sub>j</sub> 是模型参数,p是模型的阶数，u<sub>k</sub> 表示噪音,信号中不能被以前的值表示的部分。计算的认为是找到合适的 p ,使得模型的参数 a<sub>j</sub> 可以很好的描述系统。如果我们有了这样的一个系统，那么对应的 PSD 的计算为：


$$
PSD(f)=\frac{a_0}{|1+\sum_{j=1}^{p} a_{j} z^{j}|^2} ,z=e^{-2\pi if\Delta}
$$

f 是(信号)频率, &Delta; 是抽样间隔。f 是连续变量，因此不像傅立叶变化那样频率的分辨率受到数据个数的影响，而且 AR 模型不存在频率泄漏的问题。

#### 2.4.2.1 模型的阶(order)####

确定了 AR 模型的阶 p 之后，模型的参数就能被技术。可以想想节数越高，模型对数据的描述越准确。但是在实践中，时间序列总是包含了噪音,因此一个非常高的阶数的模型将会包含噪音,产生虚假的峰。太高的阶数还会是劈裂峰。相反低阶的模型，强烈的平滑谱峰，它们的位置会被移动，甚至会让一些峰消失。

建议 AR 模型和傅立叶变化联合使用，来确定合适的 AR 模型的阶数，消除虚假的谱信息。

### 2.4.3 重抽样###

RR 间隔时间序列是事件序列，每个间隔有一个时间戳（这个 RR 间隔之前的所有的 RR 间隔的累加起来）。因此这个数据可以解释为一个假设的连续函数，在 R 波时刻，被不等时抽样。无论是傅立叶变化，还是 AR 模型，都要求输入数据是等时采样。因此原始的 RR 间隔数据必须通过插值处理然后重新抽样这个明显的连续函数，得到等时采样，才能获得功率谱。

-----
**注意？**

需要注意，无论是什么方法，只要处理的数据是 **时间序列**，这就意味着，在处理 RR 间隔这样的 **事件序列** 信号的时候，都需要进行重抽样处理，使得事件序列信号变成 **时间序列**，然后才能用各种方法进行处理。

----

### 2.4.6 呼吸效应###

HF 分量随着呼吸量的下降显著的下降。随着频率下降，功率谱的峰值增加。

如果呼吸的频率低于 0.15 Hz, 就不是 HF 而是 LF 的分量占主要成份。

只有在严格控制呼吸的频率和量的时候, HF 的分量才能反映副交感神经的协调性(tone)和活性。

控制呼吸频率为一个常数，能够降低压力，这样就能影响自主神经系统，也就能影响 HRV。

当呼吸频率越接近研究对象自然的呼吸频率的时候，压力越小。

---
2016-02-14 更新

***

## 2.5 非线性分析##

### 2.5.1 近似熵和抽样熵###

所有的 **频域分析**，都是 **认出某些预先确定的模式**。

**熵** 是度量数据的 *一般规律性或信息内容* 的 **常规方法**。

#### 2.5.1.1 近似熵####
近似熵（Approximate entropy, ApEn）计算如下：

对于数据序列 *x(i)*,这里 *i = 1 ... N*, N 是数据点的个数。

$$
u(i)=[x(i),x(i+1),x(i+2),...,x(i+m-1)]
$$

m 叫做嵌入纬度。矢量 u(i)可以被解释为 m 个点的模式。首先选择 m 点模式，然后收缩相似的 m 点模式。当两个模式对应的分离之间的最大的距离 d 小于一个忍耐值 r ,就说这两个模式是相似的：

$$
d[u(i),u(j)]=max\{|u(i+k)-u(j+k)|: 0\le k \le m-1 \} \le r
$$

从 u(i) 到 u(j) 对于距离 r, 相识矢量的(正规)个数是：

$$
C_{i}^{(m)}(r)=\frac{\{下标j的个数;j\le N-m+1, d[u(i),u(j)]\le r \}}{N-m+1}
$$

由于正规化，C 最大的值是1，因此C可以认为是发现 m 点模式的概率。对所有的 m 点模式多同样的分析，然后计算所有 m 点模式的对数平均

$$
\Phi^{m}=\frac{\sum_{i=1}^{N-m+1} ln C_{i}^{m}(r)}{(N-m+1)}
$$

近似熵定义为：

$$
ApEn(m,r,N)=\Phi^{m}(r)-\Phi^{m+1}(r)
$$

ApEn 度量了相似的 m 点模式同时也是 （m+1）点相似的条件概率。换句话说，ApEn 是找到 m 点模式平均概率，减去找到 (m+1) 点模式的平均概率。

如果 ApEn = 0，表明时间序列是完全规则的。如果 &Phi;<sup>m+1</sup> 是〇，那么 ApEn 就达到最大值，这表明时间序列全集的不规则。

对HRV分析来说 ApEn 中，通常选取 参数 m=2。ApEn 的值随着 N 的增大而趋近与一个固定值。实践中，取 **N &gt; 800, m=2** 就能得到合理的结果。ApEn 的结果强烈的依赖于 r 的选择，**r 一般选择数据标准差的 15~20 %**。

因为模式的比较是基于数据的绝对值的，所以 ApEn 对数据中的最小的趋势(trends)最敏感。

当计算相识矢量个数的时候，这个矢量和自己的相似性也要计算，这就确保了 $C_{i}^{(m)}(r)$ 是非〇的。这就保证了计算 &Phi;<sub>m</sub> 时，做对数计算有意义。

#### 2.5.1.2 样本熵####
样本熵（Sample entropy,SampEn）, 去掉了矢量对自己的相似性的计算:

$$
C_{i}^{\prime m}=\frac {\{j的个数;j\ne i, j \le N - m + 1, d[u(i),u(j)] \le r\} } {N-m+1 }
$$

平均概率 &Phi; 的定义也没有对数：

$$
\Phi^{m}(r)=(N-m+1)^{-1}\sum^{N-m+1}_{i=1}C_{i}^{\prime m}(r)
$$

而 SampEn 的定义为:

$$
SampEn(m,r,N)=ln(  \frac {\Phi^{m}(r)} {\Phi^{m+1}(r)} )
$$

#### 2.5.1.3 讨论####

ApEn 在某个 r 值的时候达到最大值，而 SampEn 随着 r 值的增大而单调的减小。理论上 SampEn 不依赖数据的个数 N，但是当 N 的值很小的时候，SampEn 的统计可靠性自然的变差。当 r 和 N 足够大的时候，SampEn 和 ApEn 产生同样的结果。当数据个数比较少(N &lt; 200)的时候， SampEn 能够比 ApEn 更好的估计数据的复杂性。

规则性和复杂性通常被解释为一对相反的概念：规则性增强的时候，复杂性减低，反之依然。但并不总是这样的。

#### 2.5.1.4 多刻度熵####
**规则度** 可以通过 **模式的重复** 和 **熵** 度量的特征来计算。
**复杂性** ，直觉上来说，是和 **有意义的结构** 的 *丰富性* 相关，这也可以是非常的规则的。

基于 **熵的度量** 是随着 *自由度的数目* 而**单调增**的。因此完全不相关的数据或者白噪声的熵是最大的。这样的数据是无法预测的，但是却并不复杂。因此熵度量结果用在诸如心率这样的生理信号上的时候，就可能会产出误导的结果。所以产生这样的问题，是因为熵的度量是基于单刻度(single-scale)的分析，而生理系统的运作却是时间、空间上都是多刻度的，因此它们的复杂性是多刻度的(multiscaled)。

为了克服在上面解释熵的意义的时候遇到的问题，多刻度熵(multiscale entropy,MSE)分析被引入。

首先定义由刻度因子 &tau; 决定的去掉毛刺的时间序列：

$$
y^{\tau}(j)=\frac{1}{\tau}\sum_{i=(j-1)\tau +1}^{j\tau} x(i)
$$

这里 x(i) 是原始的时间序列，并且 1 &le; j &le; N/&tau;。y(j) 的长度等于原始数据的长度除以刻度因子(&tau;)。 然后对 y(j) 计算熵。理论上，任何一种计算变动长度的时间序列熵的方法，都可以使用，在实践上，用 SampEn 来计算 RR 间隔时间序列是一个比较好的选择。为了在较高的刻度因子上，得到好的统计相关性，**数据点的个数必须大于 10000**。


---
2016-02-15 更新

---

### 2.5.2 指数刻度##

#### 2.5.2.1 去趋势浮动分析####

对于分析一个很长的时间序列来说，区分波动的组分或重复的模式，已经不是检查 HRV 数据最好的方法了。对于长的时间序列的分析，是要找到一个方法，可以得到这数据，内部的先关性的特性。相关性表现为刻度属性和分形结构。去趋势浮动分析(Detrended Fluctuation Analysis,DFA)，作为相关性距离的函数，提供了一个可能性。

要计算 DFA ,首先要对原始数据做如下的处理，计算积分时间序列：

$$
y(k)=\sum_{i=1}^{k}(x(i)-<x>)
$$

其中，i = 1 ... N, &lt;x&gt; 是原始时间序列的平均值，而 k = 1 ... N. 然后把积分时间序列 y(k) 等分成 n 段。对每一段，通过拟合得到回归线 y<sub>n</sub>(k) . 这样处理之后的 RMS(root-mean-square) 为：

$$
DFA(n)=\sqrt{\frac{1}{N} \sum_{k=1}^{N}[y(k)-y_{n}(k)]^2}
$$

如果 log(DFA) 随着 log(n) 线性增长，就说时间序列满足（分形）标度律。线性改变的斜率 &alpha;  成为刻度指数(scaling exponent). 刻度指数定义了刻度的类型。下表给出了不同的 &alpha; 值对应的时间序列的不同的类型。

特定的时间序列的刻度指数

|---------------------+----------------------|
|刻度指数              | 信号的描述|
|----------------------|----------|
|0 &lt; &alpha; &lt; 0.5| 小值后面很可能跟一个大值，或者相反|
|&alpha; = 0.5          | 完全不相关的时间序列，也就是白噪声|
| 0.5 < &alpha; < 1.0   |小值后面很可能还跟一个小值，大值后面很可能还跟一个大值(相关的)|
| &alpha; = 1.0         | 1/f 类型的噪声|
| 1.0 < &alpha; < 1.5    | 类型变动的噪声|
| &alpha; = 1.5         | Brownian 1/f<sup>2</sup> 噪声（积分白噪声）|


---
2016-02-23 更新

---

### 2.5.3 分形维度###

一个系统的动力可以通过测量他的吸引子维度来描述。对于混沌系统，它的吸引子可以是分形的，在这个情况下，它的维度不再是整数。知道吸引子的维度可以帮助获得底层系统的有用信息。

#### 2.5.3.1 相关维度####
相关维度（correlation dimension,CD）是估量吸引子维度最简单的方法。

首先还是构造多位空间向量的时间序列：
$$
u(i)=[x(i),x(i+1),x(i+2),...,x(x+m-1)]
$$
其中 m 为嵌入维度，x(i) 是原始时间序列，i &isin;[1,N] 。然后计算从观察点出发距离为 r ,有多少个吸引子点：

$$
C_{i}^{m}=\{指标j的个数, j\le N-m+1,d[u(i),u(j)]\le r\}
$$
这里的距离 $d[u(i),u(j)]$ 的定义和近似熵（ApEn）定义中的不一样。这里使用的是欧几里德空间的距离算法：

$$
d[u(i),u(j)]=(\sum_{k=1}^{m}|u(i;k)-u(j;k)|^2)^{1/2}
$$

然后我们计算 $C_{i}^{m}(r)$ 的平均值：
$$
C^{m}(r)=\frac{1}{N-m+1}\sum_{i=1}^{N-m+1}C_{i}^{m}(r)
$$
通过 C<sup>m</sup>(r) 就可以得到相关维度 CD ：
$$
CD(m) = \lim_{r\rightarrow 0}\lim_{N \rightarrow \infty}\frac{\log C^{m}(r)}{\log r}
$$

实践上 N 的值不可能无穷大，r 的值也不可能无限接近零，所以一般采用 log-log 坐标中线性回归的斜率表示 CD。计算 CD 是嵌入维度 m 必须选定，所以最少也是 2D ，这里 D 表示的是研究的系统的维度。也就是真实变动量的个数。

为了保证 CD 的准确性，数据个数必须不少于 10<sup>m</sup>。

CD 不能精确的定义系统的实际维度，但是给出了系统复杂性的测量，也就是说等 CD 增大的时候，系统变得更加的复杂。

#### 2.5.3.3 分散分析####
通过研究时间序列描述的曲线而不是信号背后的动力系统，也可以做时间序列的维度分析。分析 RR 间隔的这个方法，和分析图片的方法相似。复杂动力系统的复杂行为在测量的时间序列中通过复杂的模式来体现，因此分析曲线的分形结构，也能给出关于系统的信息。

在分散分析中，首先计算出时间序列的标准差：

$$
SD(1)=\frac{1}{N}\sqrt{N \sum_{i=1}^{N}x^2(i)-\bar{x}^2}
$$

其中 x(i) 是原始数据，有 N 的数据点。接下来我们计算两个相邻的数据点的平均值，（整个时间序列）得到一个长度为 N/2 的新序列，再次计算这个标准差 SD(2). 一次用4，16，32 等对原序列分组，直到结果中的数据点个数少于 4 。重复上面的过程，就能得到一系列 SD(m) , 然后我们以log m，作为横坐标， log SD(m) 作为坐纵坐标，作图，如果原来的曲线是分形的话，那么就会有一条线出来。这个分形对象的维度为：FD-DA= 1-k，其中 k 是线段的斜率。这样定义的分形维度的值在1~1.5之间，1 表示信号稳定的情况，1.5 表示最大的分形特征。

### 2.5.5 其他方法###

#### 2.5.5.1 稳定测试####

简单的稳定性测试，主要是度量信号的基线的变化。测量的方法如下：把信号分成合适的几段，每段的信号的平均值都被计算好。这些平均值的 SD 除以全部信号的 SD ，就是稳定性度量$SM=\frac{SD( \bar{I_{k}} )} {SD(x(i))}$ 。如果信号是稳定的，那么这个只就会很小。 *对于 RR 间隔信号来说，**每段应该是20个数据**是合适的。如果这个值**小于0.3**，可以认为信号是**稳定的**。*

#### 2.5.5.2 符号动力学####

这个方法的基本思想是通过更加简单和粗糙的符号标记来特征花原始的时间序列。这些符号标识保留了原始时间序列的必要的动力特征。这通过把时间序列转化成一个字符串符号。这样，我把对动力学的研究简化为处理字符符号。

首先根据需要把信号分成两个或更多的带。如图所示。

![Symbol](http://i12.tietuku.com/66d0e143e163d10b.png "Symbol")

这样处理后，原始信号就变成了字符串。下一步就是把字符串分组成 *单词* 。如果单词的长度为3，那么4个不同的符号，总共有 4&times;4&times;4=64 个不同的单词。每个单词对应一个不同图形。不同的单词有不同的概率，HRV 动力偏爱某些单词。单词的概率可以解释为概率分布。通过概率可以来计算熵。
