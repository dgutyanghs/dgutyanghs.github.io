* RxSwiftçš„å®è·µ

** å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼ˆFRPï¼‰çš„å…´èµ·
*** ReactiveX
ReactiveXæ˜¯ä¸€ä¸ªå¤§å®¶åº­ï¼ŒRxSwift,RxPy,RxKotlin,RxJava ...,[[http://reactivex.io/][ReactiveXå®˜ç½‘]] .
ä½œä¸ºiOSçš„å¼€å‘è€…ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰é€šçŸ¥ä¸­å¿ƒï¼š"NotificationCenter.default"ï¼Œè¿™ä¸ªæ˜¯UIKitä¸­å¸®æˆ‘ä»¬å®ç°å¥½çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆobserver patternï¼‰ã€‚
æˆ‘ä»¬é€šè¿‡NotificationCenter.default.post(notification)å‘è®¢é˜…è€…å‘é€é€šçŸ¥ã€‚

RxSwiftå¯¹è§‚å¯Ÿè€…æ¨¡å¼è¿›è¡Œäº†æ‰©å±•ï¼Œå¾ˆå¥½åœ°ç®€åŒ–ç¨‹åºè®¾è®¡ã€‚RxSwiftæœ€é‡è¦çš„ä¸‰ä¸ªç±»å‹ï¼š =Observable= ï¼ˆå¯è¢«è§‚å¯Ÿè€…ï¼Eventå‘å‡ºè€…ï¼‰,  =Observer= ï¼ˆè§‚å¯Ÿè€…ï¼Eventæ¥æ”¶è€…ï¼‰,  =Subject= ï¼ˆObserver + Observableï¼æ—¢èƒ½å‘é€Eventï¼Œä¹Ÿèƒ½æ¥æ”¶ï¼‰.
æ‰€è°“å“åº”å¼ï¼Œäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ =Observable= å°±ä¼šå‘å‡ºEventæ¶ˆæ¯ï¼Œ =Observer= æ¥æ”¶åˆ°è®¢é˜…çš„Eventåï¼Œå¯å¯¹äº‹ä»¶è¿›è¡ŒåŠ å·¥å¤„ç†.åšå‡ºå›åº”ã€‚ 
å…³äºæ›´å¤šRxSwiftçš„åŸºç¡€çŸ¥è¯†ï¼Œå’Œä¼˜ç‚¹è¯·æµè§ˆå®˜ç½‘
** å®è·µä¾‹å­
   Flashmob å°Demoï¼Œæœ¬æ¥æ‰“ç®—ä¸Šæ¶åå†å¼€æºï¼Œä½†Appleçš„å®¡æ ¸è€…æ‹’ç»äº†2æ¬¡ï¼Œç¬¬ä¸€æ¬¡ç†ç”±æ˜¯ï¼šä¸æ”¯æŒIPv6ï¼Œæˆ‘ä¿®å¤åæäº¤ï¼Œç¬¬äºŒæ¬¡ç†ç”±æ—¶ï¼šâ€œåªæœ‰è§†é¢‘ä¸‹è½½å’Œæ’­æ”¾ï¼Œæµè§ˆå™¨ä¹Ÿèƒ½åŠåˆ°â€ã€‚è¿˜é‚®ä»¶è­¦å‘Šè¯´ä»¥åå†æäº¤å¦‚æ­¤ç®€å•çš„Appï¼Œ
   å°†å°å·.... æƒ³å¿…Appleçš„å®¡æ ¸è€…ï¼Œéƒ½æ˜¯å¼€å‘é«˜æ‰‹ï¼ï¼ï¼å”‰ï¼Œè‹¦äº†æˆ‘é‚£å‡ å¤©ç†¬å¤œæ­å»ºçš„è§†é¢‘æœåŠ¡å™¨ã€‚

   å®ç°åŠŸèƒ½ï¼š1.è§†é¢‘åˆ—è¡¨å±•ç¤º; 2.è§†é¢‘ä¸‹è½½; 3.æ’­æ”¾ã€‚ä¸‹é¢ç®€è¿°ç¨‹åºï¼Œè¯·å…ˆä¸‹è½½æºä»£ç ã€‚
*** RxCocoaç¥å¥‡tableViewä¸­çš„ç»‘å®š 
å¹³æ—¶æˆ‘ç”¨UITableView,æ€»è¦æ‰‹åŠ¨å£°æ˜éµå®ˆç›¸å…³çš„Protocol:UITableViewDataSource, UITableViewDelegate. 
#+BEGIN_SRC swift
tableView.delegate = self
tableView.dataSource = self
/// ...
#+END_SRC
ç„¶åå®ç°Protocolçš„æ–¹æ³•ï¼š
#+BEGIN_SRC swift
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        <#code#>
    }
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        <#code#>
    }

#+END_SRC
ç»†å¿ƒçš„è¯»è€…å¯èƒ½å·²ç»å‘ç°ï¼Œæˆ‘ä»¬çš„ç±»ï¼š =FirstViewController= å’Œ =SecondViewController= å¹¶ä¸éœ€è¦è¿™æ ·çš„ä»£ç 
å…ˆçœ‹ä¸‹ =SecondViewController.swift= ä¸­çš„tableViewæ•°æ®æ˜¾ç¤ºå®ç°

#+BEGIN_SRC swift
        let bag = DisposeBag()
/// ...........................

        let cellID = "aboutMeCell"
        let aboutInfo = Observable.of([("ç‰ˆæœ¬", "version:1.0.0"),
        ("ä½œè€…","Alex Yang"),
        ("E-mail", "yanghs.dgut@gmail.com"),
        ("åšå®¢","https://dgutyanghs.github.io/")])

        aboutInfo.bind(to: tableView.rx.items(cellIdentifier: cellID, cellType: UITableViewCell.self )) {
            _, item, cell  in
            cell.textLabel?.text = item.0
            cell.detailTextLabel?.text = item.1
        }.addDisposableTo(bag)

#+END_SRC

=aboutInfo= æ˜¯ä¸€ä¸ªObservable,å®ƒå°†å‘è®¢é˜…è€…å‘é€ä¸€ç»„tupleã€‚
RxCocoaåº“ä¸­UITableView+Rx.swiftçš„itemså‡½æ•°ï¼š
#+BEGIN_SRC swift
    public func items<S: Sequence, Cell: UITableViewCell, O : ObservableType>
        (cellIdentifier: String, cellType: Cell.Type = Cell.self)
        -> (_ source: O)
        -> (_ configureCell: @escaping (Int, S.Iterator.Element, Cell) -> Void)
        -> Disposable
        where O.E == S {
        return { source in
            return { configureCell in
                let dataSource = RxTableViewReactiveArrayDataSourceSequenceWrapper<S> { (tv, i, item) in
                    let indexPath = IndexPath(item: i, section: 0)
                    let cell = tv.dequeueReusableCell(withIdentifier: cellIdentifier, for: indexPath) as! Cell
                    configureCell(i, item, cell)
                    return cell
                }
                return self.items(dataSource: dataSource)(source)
            }
        }
    }
#+END_SRC

bindto å‡½æ•°ï¼š
#+BEGIN_SRC swift
    public func bind<O>(to observer: O) -> Disposable where O : ObserverType, O.E == Self.E

#+END_SRC
*** Variableç±»å‹
ä¸Šé¢çš„ä¾‹å­ä¸­ =aboutInfo= çš„æ•°æ®ä¸ºå›ºå®šçš„ã€‚è€Œåœ¨é¡¹ç›®å®é™…å¼€å‘ä¸­ï¼Œæ•°æ®æ˜¯ç»å¸¸æ›´æ–°çš„ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ›´æ–°æ•°æ®æºæ—¶ï¼ŒTableViewçš„Cellè·Ÿç€æ›´æ–°ã€‚
éœ€è¦ =aboutInfo= æ—¢èƒ½emitæ•°æ®ï¼ˆObservableï¼‰ï¼Œä¹Ÿèƒ½æ¥å—æ”¶æ®ï¼šï¼ˆObserverï¼‰.
åœ¨RxSwiftä¸­ï¼ŒVariableç±»å‹åšä¸ºSubjectç±»å‹çš„ä¸€ç§ï¼Œå®ƒå¾ˆé€‚åˆç”¨æ¥å­˜å‚¨æ—¶å¸¸éœ€è¦æ›´æ–°TableViewæ•°æ®æºã€‚
Subjectç±»å‹æ—¢èƒ½ä½œObservableï¼Œä¹Ÿèƒ½ä½œObserverã€‚
æ‰“å¼€ =FirstViewController.swift= æ–‡ä»¶:
#+BEGIN_SRC swift
/// videoArray å£°æ˜ä¸ºä¸€ä¸ªå¯å­˜å‚¨Videoçš„æ•°ç»„
var videoArray = Variable<[Video]> ([])

/// videoArray.asObservable ä½œä¸ºObservable
videoArray.asObservable().observeOn(MainScheduler.instance).bind(to: tableView.rx.items(cellIdentifier: cellID, cellType: VideoInfoCell.self)) {
            _, videoItem, cell  in
            cell.titleLabel.text = "  " + videoItem.title
            cell.bgImageView.af_setImage(withURL: URL.init(string: videoItem.cover)!)
            cell.textView.text = videoItem.desc
            cell.progressBar.progress = videoItem.progress
            if videoItem.progress == 1.0 {
                cell.titleLabel.textColor = UIColor.green
            }else {
                cell.titleLabel.textColor = UIColor.white
            }
        }.addDisposableTo(bag)

/// ä¸‹è½½Videoåˆ—è¡¨infoï¼Œsuccessæ˜¯ï¼Œå¯æ›´æ–°æ•°æ®ã€‚å¯¹self.VideoArray.valueèµ‹å€¼åã€‚ä¼šè‡ªåŠ¨ä¸Šé¢ä»£ç çš„Observable,ä»è€Œreload tableView.
    func downloadVideoInfo(from index: Int = 0) {
            let urlString = "https://..."
            let param = ["index": index]
            _ = Alamofire.request(urlString, method: .post, parameters: param)
                .responseJSON { [weak self] (response) in
                    switch response.result {
                    case .success(let json):
                        let newArray = Video.generateModel(with:JSON(json))
                        if let `self` = self {
                            self.videoArray.value = self.mergeVideoArrays(originArray: self.videoArray.value, newArray: newArray)
                        }
                    case .failure(let error):
                        print(error.localizedDescription)
                    }
                }
       }


#+END_SRC
videoArrayæ—¢æ˜¯Observer,ä¹Ÿæ˜¯Observableï¼Œå½“å®ƒæ”¶åˆ°æ›´æ–°æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘Observableï¼Œå°†è‡ªå·±çš„valueå…¨éƒ¨å‘é€ã€‚ 
*** è§†é¢‘ä¸‹è½½çš„Progressè¿›åº¦æ›´æ–°
#+BEGIN_SRC swift
func downloadVideo(video: Video, indexPath: IndexPath) {
  /// ...
    .subscribe(onNext: {
        [weak self] progress in
        print(" index:\(indexPath.row) :\(video.title) progress : \(progress.completed)")
        let cell = self?.tableView.cellForRow(at: indexPath) as? VideoInfoCell
        cell?.progressBar.progress = progress.completed
    }, onCompleted: {
        [weak self] in
        print("download completed")

        if let `self` = self {
            self.videoArray.value[indexPath.row].setProgress(value: 1.0)
            let item = self.videoArray.value[indexPath.row]
            self.showMessage(item.title, title:"ä¸‹è½½å®Œæˆ", theme: .success)
            ///save Plist
            Video.saveValuesToDefaults(newValues: self.videoArray.value, key: self.videoArrayKey)
        }

    }).addDisposableTo(bag)

}

///æŸ¥çœ‹downloadVideoä¸­çš„subscribeéƒ¨åˆ†ï¼Œè®¢é˜…äº† onNext, å’ŒonCompleteäº‹ä»¶ï¼Œ
///onNextæ›´æ–°è¿›åº¦ï¼ŒonCompletedæ›´æ–°UIï¼Œä¿å­˜æ•°æ®ã€‚
#+END_SRC
*** Eventçš„å˜æ¢å’Œåˆå¹¶
RxCocoaä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»é€‰æ‹©UITableViewCellæ—¶ï¼Œä¼šè§¦å‘ä¸¤ä¸ªObservableã€‚
#+BEGIN_SRC swift
/// video æ•°æ®
tableView.rx.modelSelected(Video.self)
/// tableView cell å¯¹åº”çš„indexPath
tableView.rx.itemSelected

#+END_SRC

è¿™ä¸ªDemoçš„è®¾è®¡æ˜¯ï¼Œå½“ç”¨æˆ·é€‰æ‹©æŸä¸ªCellæ—¶ï¼Œå¦‚æœè¯¥cellçš„è§†é¢‘æ•°æ®æœªåœ¨æœ¬åœ°ï¼Œåˆ™å¯åŠ¨ä¸‹è½½ã€‚åä¹‹ï¼Œæ’­æ”¾è§†é¢‘ã€‚
ä½ å¯ä»¥å°è¯•è¿™æ ·å†™ï¼š
#+BEGIN_SRC swift
       let cellObservable = tableView.rx.modelSelected(Video.self).share()
        
        cellObservable.filter { (video) -> Bool in
            return video.progress == 1.0
            }.subscribe(onNext: {
                self.playVideo($0)
            }).addDisposableTo(bag)
        
        cellObservable.filter { (video) -> Bool in
            return video.progress < 1.0 ? true : false
            }.subscribe(onNext: {
                _ in
                print("start download video file")
            }).addDisposableTo(bag)
#+END_SRC
å½“ä¸‹è½½Videoæ—¶ï¼Œæ²¡æœ‰IndexPathå‚æ•°ï¼Œå¯¼è‡´æ— æ³•æ›´æ–°cellçš„è¿›åº¦æ¡ã€‚
èƒ½ä¸èƒ½æ—¢æœ‰videoï¼Œä¹Ÿæœ‰indexPathï¼Œè¿™æ˜¯è¦ç”¨åˆ°Operator(combineLatest)äº†ã€‚å°†ä¸¤ä¸ªObservableçš„äº‹ä»¶åˆå¹¶
#+BEGIN_SRC swift
        let cellTapedObservable = Observable.combineLatest(tableView.rx.modelSelected(Video.self), tableView.rx.itemSelected) { (videoItem, indexPath) -> (Video, IndexPath)   in
            return (videoItem, indexPath)
        }
        
        cellTapedObservable.debounce(0.5, scheduler: ConcurrentMainScheduler.instance)
            .subscribe(onNext: {
           [weak self]  tuple in
                
            let video = tuple.0
            /// 1: video has download finished, play it
            if video.progress == 1.0 {
                self?.playVideo(video)
            }else {
            /// 2: start to download video file
               self?.downloadVideo(video: tuple.0, indexPath: tuple.1)
            }
            
        }).addDisposableTo(bag)

#+END_SRC

*** https è®¿é—®é™åˆ¶çš„åº”å¯¹æ–¹æ³• 
    å¦‚æœä½ çš„æœåŠ¡å™¨æœ‰æ­£è§„çš„httpsè¯ä¹¦çš„ï¼Œä¸ç”¨è€ƒè™‘æ­¤æ­¥éª¤ã€‚
**** ä¿®æ”¹ä½ Appé¡¹ç›®ä¸­çš„Info.plistæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹é¡¹ 
#+BEGIN_SRC xml
<key>NSAppTransportSecurity</key>
	<dict>
		<key>NSAllowsArbitraryLoads</key>
		<false/>
		<key>NSExceptionDomains</key>
		<dict>
			<key>120.25.206.78</key> 
			<dict>
				<key>NSExceptionAllowsInsecureHTTPLoads</key>
				<true/>
				<key>NSExceptionRequiresForwardSecrecy</key>
				<false/>
				<key>NSIncludesSubdomains</key>
				<true/>
			</dict>
			<key>www.popiano.org</key>
			<dict>
				<key>NSExceptionAllowsInsecureHTTPLoads</key>
				<true/>
				<key>NSExceptionRequiresForwardSecrecy</key>
				<false/>
				<key>NSIncludesSubdomains</key>
				<true/>
			</dict>
		</dict>
	</dict>

#+END_SRC
ä½ çš„æœåŠ¡å™¨æ²¡ç”³è¯·åŸŸåçš„è¯ï¼Œä¹Ÿå¯ç”¨ç›´æ¥å†™ä¸ŠIPåœ°å€ï¼ˆå¦‚ï¼š120.25.206.78ï¼‰ 
å¦‚æœ‰å°±ç›´æ¥å†™ä¸Šï¼ˆå¦‚ï¼šwww.popiano.orgï¼‰
**** Appå¯åŠ¨æ˜¯åˆå§‹è¯ç½‘ç»œé…ç½® 

åœ¨æ–‡ä»¶AppDelegate.swift ä¸­å¯åŠ¨å‡½æ•°åŠ è½½å®ƒ
#+BEGIN_SRC swift
import Alamofire
/// .................


func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        // Override point for customization after application launch.
       
        configureAlamofireManager()
        
        return true
    }

        /// MARK: HTTPS è®¤è¯ å¤„ç†
    func configureAlamofireManager() {
        let manager = SessionManager.default
        
        manager.delegate.sessionDidReceiveChallenge = { session, challenge in
            var disposition: URLSession.AuthChallengeDisposition = .performDefaultHandling
            var credential: URLCredential?

            if challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust {
                disposition = URLSession.AuthChallengeDisposition.useCredential
                credential = URLCredential(trust: challenge.protectionSpace.serverTrust!)
            } else {
                if challenge.previousFailureCount > 0 {
                    disposition = .cancelAuthenticationChallenge
                } else {
                    credential = manager.session.configuration.urlCredentialStorage?.defaultCredential(for: challenge.protectionSpace)

                    if credential != nil {
                        disposition = .useCredential
                    }
                }
            }
            return (disposition, credential)
        }
    }
#+END_SRC
è‡³æ­¤ï¼Œä½ çš„Appçš„Httpsç½‘ç»œè®¿é—®é—®é¢˜è§£å†³ã€‚

**** ç¬”è€…çš„æ–°æœåŠ¡å™¨
ä¸ºäº†è§£å†³ç¬¬ä¸€æ¬¡IPv6è¢«æ‹’ï¼Œç¬”è€…çš„æ–°æœåŠ¡å™¨æ¶åˆ°å›½å¤–äº†ã€‚å¸¦å®½é«˜é€Ÿåº¦å¿«,å±…ç„¶è¿˜æ¯”å›½å†…çš„VPSè¦ä¾¿å®œï¼ŒåŸŸåå’ŒSSLè¯ä¹¦ä¹Ÿéƒ½ç”³è¯·å®Œæˆï¼Œæˆæ­£è§„å†›äº†ã€‚ä¸ç”¨å†ä¸ºHTTPSçš„é—®é¢˜çƒ¦æ¼äº†ã€‚å„ä½çœ‹å®˜ï¼Œä¹°VPSæ—¶ï¼Œè´§æ¯”3å®¶ã€‚

*** æ€»ç»“
Function Reactive  Programming ï¼ˆFRP)çš„æ–¹å¼ç¼–ç¨‹ï¼Œéš¾ç‚¹åœ¨äºç†è§£Eventæµå’Œå¯¹å„ç§æ•°æ®çš„æ“ä½œï¼Œå˜æ¢ã€‚
å¯¹ä»¥å¾€å‘½ä»¤å¼ç¼–ç¨‹æ˜¯ä¸€ç§é¢ è¦†ã€‚
ä»£è¡¨å…ˆè¿›çš„ç”Ÿäº§åŠ›ï¼›ä»£è¡¨å¹¿å¤§ç å†œçš„å‰è¿›æ–¹å‘ï¼›....

[[https://github.com/dgutyanghs/Flashmob][Flashmob]] çš„æºç 
å–œæ¬¢çš„è¯·æ”¯æŒstarä¸€ä¸‹ï¼Œä½ çš„æ”¯æŒæ˜¯å¯¹ç¬”è€…çš„é¼“èˆã€‚è°¢è°¢í ½í¹
